<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CareerBridge Pro Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>
<style>
:root {
  --bg:#f7f9fc; --card-bg:white; --text:#111; --primary:#14b8a6; --primary-dark:#0d9488; --accent:#2dd1c3;
}
body.dark {--bg:#111827;--card-bg:#1f2937;--text:#f1f5f9;--primary:#2dd1c3;--primary-dark:#0d9488;--accent:#14b8a6;}
body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg);color:var(--text);}
.container{padding:30px;max-width:1400px;margin:auto;}
h1,h2,h3{text-align:center;margin-bottom:10px;}
h1{font-size:2.6rem;} h2{font-size:2rem;} h3{font-size:1.4rem;}

/* --- Header --- */
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:40px;flex-wrap:wrap;}
.user-profile{display:flex;align-items:center;gap:10px;}
.user-profile img{width:50px;height:50px;border-radius:50%;border:2px solid var(--primary);}
.toggle-btn{padding:10px 20px;border:none;border-radius:20px;cursor:pointer;font-weight:600;background:var(--primary);color:white;transition:0.3s;}
.toggle-btn:hover{opacity:0.8;}

/* --- Metrics cards --- */
.metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
.metric-card{background:var(--card-bg);padding:25px;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,0.08);text-align:center;transition:0.3s;}
.metric-card:hover{transform:translateY(-5px);box-shadow:0 20px 40px rgba(0,0,0,0.12);}
.metric-card h2{font-size:2rem;color:var(--primary);margin:10px 0;}

/* --- Dashboard Cards --- */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px;}
.card{background:var(--card-bg);padding:28px;border-radius:20px;box-shadow:0 15px 35px rgba(0,0,0,0.08);transition:0.3s;position:relative;}
.card:hover{transform:translateY(-6px);box-shadow:0 25px 50px rgba(0,0,0,0.12);}
.card h3{text-align:left;margin-bottom:12px;color:var(--primary);}

/* --- Timeline --- */
.timeline{display:flex;overflow-x:auto;gap:20px;padding:10px 0;}
.milestone{min-width:180px;background:var(--primary);color:white;padding:20px;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,0.08);text-align:center;flex-shrink:0;transition:0.3s;}
.milestone:hover{transform:scale(1.05);}

/* --- Skill bars --- */
.progress-container{margin:12px 0;}
.progress-label{font-weight:500;margin-bottom:6px;}
.progress-bar{height:24px;border-radius:12px;background:#ddd;overflow:hidden;}
.progress-fill{height:100%;width:0%;border-radius:12px;background:linear-gradient(90deg,var(--primary),var(--accent));text-align:center;color:white;font-weight:600;line-height:24px;transition:width 1.5s;}

/* --- Map --- */
#map{height:400px;border-radius:20px;}

/* --- Resources --- */
.resources{margin-top:15px;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;}
.resource-item{padding:12px 16px;background:#e6fffa;border-radius:14px;text-align:center;font-weight:500;transition:0.3s;cursor:pointer;}
body.dark .resource-item{background:#374151;}
.resource-item:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(0,0,0,0.08);}

/* --- Resume button --- */
.resume-btn{display:block;margin:20px auto;padding:14px 32px;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;border:none;border-radius:22px;font-weight:700;font-size:1rem;cursor:pointer;transition:0.3s;}
.resume-btn:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(20,184,166,0.4);}

/* --- Pie chart --- */
canvas{background:var(--card-bg);border-radius:20px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,0.06);}
</style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>CareerBridge Pro Dashboard</h1>
    <div class="user-profile">
      <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User Avatar">
      <div id="welcome">Hello!</div>
      <button class="toggle-btn" id="toggleTheme">Dark Mode</button>
    </div>
  </div>

  <!-- Metrics cards -->
  <div class="metrics">
    <div class="metric-card">
      <h3>Readiness Score</h3>
      <h2 id="score">--%</h2>
    </div>
    <div class="metric-card">
      <h3>Skills Learned</h3>
      <h2 id="learnedCount">--</h2>
    </div>
    <div class="metric-card">
      <h3>Missing Skills</h3>
      <h2 id="missingCount">--</h2>
    </div>
    <div class="metric-card">
      <h3>Roadmap Weeks</h3>
      <h2 id="weeksCount">--</h2>
    </div>
  </div>

  <!-- Dashboard Cards -->
  <div class="cards">
    <div class="card">
      <h3>Skill Comparison</h3>
      <div id="skillBars"></div>
    </div>

    <div class="card">
      <h3>Skill Distribution</h3>
      <canvas id="skillPieChart"></canvas>
    </div>

    <div class="card">
      <h3>Career Roadmap</h3>
      <div class="timeline" id="timeline"></div>
    </div>

    <div class="card">
      <h3>Hackathons & Learning Centers</h3>
      <div id="map"></div>
    </div>

    <div class="card">
      <h3>Learning Resources</h3>
      <div class="resources" id="resources"></div>
      <button class="resume-btn" onclick="window.open('https://resumegenius.com/resume-builder','_blank')">Build Your Resume</button>
    </div>
  </div>
</div>

<script>
// Dark/Light toggle
const toggleBtn = document.getElementById("toggleTheme");
toggleBtn.onclick = () => {
    document.body.classList.toggle("dark");
    toggleBtn.innerText = document.body.classList.contains("dark") ? "Light Mode" : "Dark Mode";
}

// Query params
const urlParams = new URLSearchParams(window.location.search);
const skillsInput = urlParams.get("skills") || "Python,DSA";
const domain = urlParams.get("domain") || "web";

document.getElementById("welcome").innerText = `Hello! Analyzing your skills in ${domain.toUpperCase()}`;

// Fetch data
fetch(`http://127.0.0.1:8000/analyze?domain=${domain}`)
.then(res=>res.json())
.then(data=>{
    // Metrics
    document.getElementById("score").innerText = data.score+"%";
    document.getElementById("learnedCount").innerText = data.skills.have.length;
    document.getElementById("missingCount").innerText = data.skills.missing.length;
    document.getElementById("weeksCount").innerText = data.roadmap.length;

    // Skill Bars
    const skillBarsDiv = document.getElementById("skillBars");
    skillBarsDiv.innerHTML="";
    const allSkills = [...data.skills.have,...data.skills.missing];
    allSkills.forEach(skill=>{
        const container=document.createElement("div");
        container.className="progress-container";
        const label=document.createElement("div");
        label.className="progress-label";
        label.innerText=skill + (data.skills.have.includes(skill)?" ✅":" ❌");
        const bar=document.createElement("div");
        bar.className="progress-bar";
        const fill=document.createElement("div");
        fill.className="progress-fill";
        fill.style.width = data.skills.have.includes(skill)?"100%":"0%";
        fill.innerText = data.skills.have.includes(skill)?"Learned":"Pending";
        bar.appendChild(fill);
        container.appendChild(label);
        container.appendChild(bar);
        skillBarsDiv.appendChild(container);
        if(!data.skills.have.includes(skill)){
            setTimeout(()=>{fill.style.width="70%"; fill.innerText="Need to Learn";},200);
        }
    });

    // Pie chart
    new Chart(document.getElementById("skillPieChart"), {
      type:"doughnut",
      data:{
        labels:allSkills,
        datasets:[{
          data:[...data.skills.have.map(()=>1),...data.skills.missing.map(()=>1)],
          backgroundColor:["#14b8a6","#0d9488","#5eead4","#99f6e4"]
        }]
      },
      options:{plugins:{legend:{position:"bottom"}}}
    });

    // Timeline
    const timeline=document.getElementById("timeline");
    timeline.innerHTML="";
    data.roadmap.forEach((step,i)=>{
      const div=document.createElement("div");
      div.className="milestone";
      div.style.backgroundColor = i%2===0? "#14b8a6":"#2dd1c3";
      div.innerText=`Week ${i+1} → ${step}`;
      timeline.appendChild(div);
    });

    // Resources
    const resourcesDiv = document.getElementById("resources");
    const resources = [
      {name:"FreeCodeCamp", link:"https://www.freecodecamp.org/"},
      {name:"Coursera", link:"https://www.coursera.org/"},
      {name:"Udemy", link:"https://www.udemy.com/"},
      {name:"GeeksforGeeks", link:"https://www.geeksforgeeks.org/"},
      {name:"EdX", link:"https://www.edx.org/"}
    ];
    resources.forEach(r=>{
      const div=document.createElement("div");
      div.className="resource-item";
      div.innerHTML=`<a href="${r.link}" target="_blank">${r.name}</a>`;
      resourcesDiv.appendChild(div);
    });

    // Map
    const map = L.map('map').setView([20.5937,78.9629],4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Map' }).addTo(map);
    const hackathons = [
      {lat:28.6139,lng:77.209,name:"Devpost Hackathon",idea:"Build a Web App"},
      {lat:19.0760,lng:72.8777,name:"AI Challenge",idea:"ML Model for Predictions"},
      {lat:12.9716,lng:77.5946,name:"IoT Hackathon",idea:"Smart IoT Device"}
    ];
    const learningCenters = [
      {lat:28.7041,lng:77.1025,name:"Coding Ninjas",domain:"Web/DSA"},
      {lat:19.2183,lng:72.9781,name:"Coursera Local Center",domain:"AI/ML"},
      {lat:12.9716,lng:77.6412,name:"Udemy Workshop",domain:"Python/ML"}
    ];
    hackathons.forEach(h=>{ L.marker([h.lat,h.lng]).addTo(map).bindPopup(`<b>${h.name}</b><br>Idea: ${h.idea}`); });
    learningCenters.forEach(l=>{ L.marker([l.lat,l.lng]).addTo(map).bindPopup(`<b>${l.name}</b><br>Domain: ${l.domain}`); });
})
.catch(err=>console.error(err));
</script>
</body>
</html>
